pipeline {
    agent any
    stages {
        stage('install playwright') {
        steps {
            bat '''
            npm i
            npx playwright install
            '''
        }
        }
        stage('test') {
        steps {
            bat '''
            rmdir /s /q allure-results
            npx playwright test chain_test
            copy environment.xml /allure-results
            '''
        }
           post {
            success {
            if (fileExists("results-cucumber")) {
              archiveArtifacts(artifacts: 'results-cucumber/**', followSymlinks: true)
            } else {
              bat 'echo "No test Artifacts."'
            }
            }
        }
        }
    }
    post {
        always {
            allure([
                includeProperties: false,
                jdk: '',
                properties: [],
                reportBuildPolicy: 'ALWAYS',
                results: [[path: 'allure-results']]
            ])
        }
    }
}