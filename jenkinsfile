pipeline {
    agent any
    stages {
        stage('install playwright') {
        steps {
            bat '''
            npm i
            npx playwright install
            '''
        }
        }
        stage('test') {
          steps {
              bat '''
              npm run allure:clean
              copy environment.xml ./allure-results
              npx playwright test chain_test
              '''
          }
          post {
            success {
              slackSend (color: 'good', iconEmoji: 'thumbsup', message: `Test du pipeline z-train à réussi. <${env.BUILD_URL}|Open>`)
              script{
                if (fileExists("results-cucumber")) {
                  archiveArtifacts(artifacts: 'results-cucumber/**', followSymlinks: true)
                } else {
                  bat 'echo "No test Artifacts."'
                }
              }
            }
            failure {
              slackSend (color: 'danger', iconEmoji: 'thumbsdown', message: `Test du pipeline z-train à réussi. <${env.BUILD_URL}|Open>`)
            }
          }
        }
    }
    post {
      always {
        allure([
            includeProperties: false,
            jdk: '',
            properties: [],
            reportBuildPolicy: 'ALWAYS',
            results: [[path: 'allure-results']]
        ])
      }
    }
}